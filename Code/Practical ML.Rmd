---
title: "Practical ML"
author: "the-eon-flux"
date: "26/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(caret)
library(kernlab)
data(spam)
```

## Machine learning algorithms in R

* Linear discriminant analysis
* Regression
* Naive Bayes
* Support vector machines
* Classification and regression trees
* Random forests
* Boosting
* etc. 

***

## `caret` package functionalities

* Some preprocessing (cleaning)
  * preProcess
* Data splitting
  * createDataPartition
  * createResample
  * createTimeSlices
* Training/testing functions
  * train
  * predict
* Model comparison
  * confusionMatrix

***

### Data Splitting

* `createDataPartition()` : allows you to split the data easily

```{r spam, echo=FALSE, cache=TRUE}
dim(spam)

inTrain <- createDataPartition(y = spam$type, p = 0.75, list = FALSE)
        # Train the model with 75% data; p = 0.75
training <- spam[inTrain,]

testing <- spam[-inTrain,]
dim(training)
```

### Fit a model

* `train()` : To fit a model

```{r Train, cache=TRUE}

set.seed(32343)

modelFit <- train(type ~. , data = training, method = "glm")
modelFit # Consice summary
```

* Best model from the bootstraps

```{r Train_1}

# Best model after bootstraping
modelFit$finalModel

```


### Predictions

```{r Prediction, cache=TRUE}

predictions <- predict(modelFit, newdata = testing)
head(predictions)

```

### Confusion Matrix

* Shows a contingency table & other summary statistics

```{r Model_Comparisons, cache=TRUE}

Results <- confusionMatrix(predictions, testing$type)
Results
```

## Additional data sampling methods : 

### K-fold sampling

* K fold sampling : 

```{r k_fold}

set.seed(73)

# Training set returned
folds <- createFolds(y = spam$type, k =10, list = TRUE, returnTrain = TRUE)
sapply(folds, length)

```

* For test set

```{r k_fold2, cache=TRUE}

set.seed(73)

# Testing set returned
folds <- createFolds(y = spam$type, k =10, list = TRUE, returnTrain = FALSE)
sapply(folds, length)
names(folds)

```


### Additional data sampling methods : Resampling

* `Resampling` method with replacement

```{r Resampling, cache=TRUE}
set.seed(32323)
folds <- createResample(y = spam$type, times = 10, list = TRUE)
sapply(folds, length)

```

### Additional data sampling methods : Timeslices resampling

* The param `initialWindow` is for defining the initial number of consecutive values in each training set sample.

* The param `horizon` is for defining the initial number of consecutive values in each testing set sample.

```{r Time Slices,cache=TRUE}

time <- 1:1000
folds <- createTimeSlices(y = time, initialWindow = 20, horizon = 10)

# Gives training slices
folds$train[[1]] 

# Test slices
folds$test[[1]]

```


## Additional training methods : 

* `preProcess` param : Set preprocessing options

* `weights` param : Give weightage (for eg when samples of 1 class are more)

```{r Training_opts, eval=FALSE}

# Default args for train()

function(x, y,
            method = "rf",
            preProcess = NULL,
            ...,
            weights = NULL,
            metric = ifelse(is.factor(y), "Accuracy", "RMSE"),
            maximize = ifelse(metric %in% c("RMSE", "logLoss", "MAE"), FALSE, TRUE),
            trControl = trainControl(),
            tuneGrid = NULL,
            tuneLength = ifelse(trControl$method == "none", 1, 3))

```

* `metric` param : Options

      * Continous outcomes
            * RMSE = Root mean squared error
            * RSquared = $R^2$ from Regression models
      * Categorcial outcomes
            * Accuracy = Fraction of correct
            * Kappa = Measure of concordance

* trainControl (`trControl`) param arguments give you detailed parameter setting options to train models

      * `number` = Bootstrapping count
      * `p` = size of training set
      * `seeds` = Setting seed while doing parallel processing
      * `repeat` = Number of times to repeat subsampling

```{r eval=FALSE}

# args(trainControl)

function (method = "boot", number = ifelse(grepl("cv", 
    method), 10, 25), repeats = ifelse(grepl("[d_]cv$", 
    method), 1, NA), p = 0.75, search = "grid", initialWindow = NULL, 
    horizon = 1, fixedWindow = TRUE, skip = 0, verboseIter = FALSE, 
    returnData = TRUE, returnResamp = "final", savePredictions = FALSE, 
    classProbs = FALSE, summaryFunction = defaultSummary, selectionFunction = "best", 
    preProcOptions = list(thresh = 0.95, ICAcomp = 3, k = 5, 
        freqCut = 95/5, uniqueCut = 10, cutoff = 0.9), sampling = NULL, 
    index = NULL, indexOut = NULL, indexFinal = NULL, timingSamps = 0, 
    predictionBounds = rep(FALSE, 2), seeds = NA, adaptive = list(min = 5, 
        alpha = 0.05, method = "gls", complete = TRUE), 
    trim = FALSE, allowParallel = TRUE)

```













